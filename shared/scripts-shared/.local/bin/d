#!/bin/sh

set -eu

OP="$1"
shift

if [[ mount = "$OP"* ]]; then
	OP=mount
elif [[ unmount = "$OP"* ]] || [[ umount = "$OP"* ]]; then
	OP=unmount
else
	echo 'invalid operation. expected mount or unmount/umount' >&2
	exit 1
fi

DISK="$1"
shift

if [[ zdani = "$DISK"* ]]; then
	DISK=zdani
elif [[ sivydatni = "$DISK"* ]]; then
	DISK=sivydatni
elif [[ muhackiku = "$DISK"* ]]; then
	DISK=muhackiku
elif [[ barda = "$DISK"* ]]; then
	DISK=barda
else
	echo 'invalid/unknown disk. expected zdani, sivydatni, muhackiku, or barda' >&2
	exit 1
fi

case $DISK in
	zdani|barda)
		udisksctl $OP -b /dev/disk/by-label/$DISK
		exit
		;;
	sivydatni)
		UUID=a02adf15-769d-4b61-9122-ddb3b3d1e7c2
		INNER_UUID=ac80428f-f91d-4b99-9d40-c885d122be18
		;;
	muhackiku)
		UUID=809dbaf9-4c95-4baf-890c-e6866dd1a913
		INNER_UUID=e1258f59-cb99-4b6b-8bd7-513c66d64439
		;;
esac

case $OP in
	mount)
		udisksctl unlock -b /dev/disk/by-uuid/$UUID
		udisksctl mount -b /dev/disk/by-uuid/$INNER_UUID
		;;
	unmount)
		udisksctl unmount -b /dev/disk/by-uuid/$INNER_UUID
		udisksctl lock -b /dev/disk/by-uuid/$UUID
		;;
esac
